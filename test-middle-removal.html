<!DOCTYPE html>
<html>
	<head>
		<title>Test Middle Element Removal</title>
		<style>
			.item {
				padding: 10px;
				margin: 5px;
				border: 1px solid #ccc;
				transition: all 0.3s ease;
				background: #f9f9f9;
			}
			button {
				margin: 5px;
				padding: 8px 12px;
				background: #007acc;
				color: white;
				border: none;
				border-radius: 4px;
				cursor: pointer;
			}
			button:hover {
				background: #005a9e;
			}
			#array-display {
				font-weight: bold;
				font-family: monospace;
				background: #eee;
				padding: 5px;
				border-radius: 3px;
			}
		</style>
	</head>
	<body>
		<h1>🎯 :each Middle Element Removal Demo</h1>

		<div>
			<h2>Current Array: <span id="array-display"></span></h2>
			<button onclick="removeMiddle()">Remove Middle Element</button>
			<button onclick="removeFirst()">Remove First Element</button>
			<button onclick="removeLast()">Remove Last Element</button>
			<button onclick="reset()">Reset Array</button>
		</div>

		<div style="margin-top: 20px">
			<h3>Items:</h3>
			<ul id="list">
				<li :each="items as item, i" class="item">
					Item ${i}: ${item}
				</li>
			</ul>
		</div>

		<div
			style="
				margin-top: 20px;
				padding: 15px;
				background: #e6f3ff;
				border-radius: 5px;
			"
		>
			<h4>🔧 What this demonstrates:</h4>
			<p>
				<strong>Before the fix:</strong> Removing a middle element would
				incorrectly animate out the last element, even though the middle
				element was actually removed.
			</p>
			<p>
				<strong>After the fix:</strong> The system now properly tracks
				which DOM element corresponds to which array value, so removing
				the middle element will correctly animate out the middle DOM
				element while preserving the first and last elements.
			</p>
		</div>

		<script type="module">
			import { RegEl, StateBuilder } from "./dist/manifold.es.js";

			const state = StateBuilder.create(undefined, {
				items: [
					"🟢 first",
					"🟡 middle",
					"🔴 last",
					"🟣 fourth",
					"🟠 fifth",
				],
			}).build();

			function updateDisplay() {
				document.getElementById("array-display").textContent =
					JSON.stringify(state.items);
			}

			function removeMiddle() {
				// Remove the middle element (index 2)
				const newItems = [...state.items];
				const middleIndex = Math.floor(newItems.length / 2);
				console.log(
					"Removing middle element at index " +
						middleIndex +
						": " +
						newItems[middleIndex]
				);
				newItems.splice(middleIndex, 1);
				state.items = newItems;
				updateDisplay();
			}

			function removeFirst() {
				if (state.items.length > 0) {
					const newItems = [...state.items];
					console.log("Removing first element: " + newItems[0]);
					newItems.shift();
					state.items = newItems;
					updateDisplay();
				}
			}

			function removeLast() {
				if (state.items.length > 0) {
					const newItems = [...state.items];
					console.log(
						"Removing last element: " +
							newItems[newItems.length - 1]
					);
					newItems.pop();
					state.items = newItems;
					updateDisplay();
				}
			}

			function reset() {
				console.log("Resetting array");
				state.items = [
					"🟢 first",
					"🟡 middle",
					"🔴 last",
					"🟣 fourth",
					"🟠 fifth",
				];
				updateDisplay();
			}

			// Initialize
			const template = document.querySelector("li");
			new RegEl(template, state);
			updateDisplay();

			// Make functions global for buttons
			window.removeMiddle = removeMiddle;
			window.removeFirst = removeFirst;
			window.removeLast = removeLast;
			window.reset = reset;

			console.log(
				"Demo ready! Try removing different elements and watch the transitions."
			);
		</script>
	</body>
</html>
